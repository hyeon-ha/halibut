
-- 산차별 모돈 성적 추출 
SELECT A.FARM_NO 
     , D.FARM_PIG_NO -- 모돈번호
     , B.SANCHA AS BUNMAN_SANCHA -- 산차
     , A.WK_DT AS GYOBAE_DT -- 교배일
     , B.WK_DT AS BUNMAN_DT -- 분만일
     , (SELECT SILSAN+MILA+SASAN FROM TB_BUNMAN WHERE FARM_NO=B.FARM_NO AND PIG_NO=B.PIG_NO AND WK_DT=B.WK_DT AND WK_GUBUN=B.WK_GUBUN) AS CHONGSAN -- 총산
     , (SELECT SILSAN FROM TB_BUNMAN WHERE FARM_NO=B.FARM_NO AND PIG_NO=B.PIG_NO AND WK_DT=B.WK_DT AND WK_GUBUN=B.WK_GUBUN) AS SILSAN --실산
     , (SELECT NVL(DUSU,0)+NVL(DUSU_SU,0) FROM TB_EU WHERE FARM_NO=C.FARM_NO AND PIG_NO=C.PIG_NO AND WK_DT=C.WK_DT AND WK_GUBUN=C.WK_GUBUN) AS EUDUSU -- 이유두수
     , (SELECT NVL(TOTAL_KG,0) FROM TB_EU WHERE FARM_NO=C.FARM_NO AND PIG_NO=C.PIG_NO AND WK_DT=C.WK_DT AND WK_GUBUN=C.WK_GUBUN) AS EUKG -- 이유체중
     , CASE WHEN A.SANCHA=0 AND A.GYOBAE_CNT=1 THEN TO_DATE(A.WK_DT)-TO_DATE(D.BIRTH_DT) END AS CHOGYOBAE -- 초교배일령
     , CASE  WHEN A.SANCHA>0 THEN TO_DATE(A.WK_DT)-TO_DATE((SELECT WK_DT FROM TB_MODON_WK WHERE FARM_NO=A.FARM_NO AND PIG_NO=A.PIG_NO AND SEQ=A.SEQ-1 AND WK_GUBUN='E')) END AS JAE -- 재귀일령
  FROM TB_MODON_WK A, TB_MODON_WK B, TB_MODON_WK C, TB_MODON D
 WHERE A.FARM_NO = B.FARM_NO
   AND A.PIG_NO = B.PIG_NO
   AND A.SEQ = B.SEQ-1
   AND A.FARM_NO = C.FARM_NO
   AND A.PIG_NO = C.PIG_NO
   AND A.SEQ = C.SEQ-2
   AND A.FARM_NO = D.FARM_NO
   AND A.PIG_NO = D.PIG_NO   
   AND A.FARM_NO = '1387'
   AND A.WK_GUBUN = 'G'
   AND B.WK_GUBUN = 'B'